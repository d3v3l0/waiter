global
    maxconn 4096
    nbproc 1
    nbthread 1
    tune.maxrewrite 32768
    tune.bufsize 65536

defaults
    mode http
    option abortonclose
    option http-use-htx
    timeout connect 60s
    timeout client 60s
    timeout server 60s

frontend waiter
    bind *:9090 proto h2

    acl is-ssl-acl dst_port 9093
    http-request set-header X-Forwarded-Proto http if !is-ssl-acl
    http-request set-header X-Forwarded-Proto https if is-ssl-acl

    acl is-http2 fc_http_major 2
    http-request set-header X-Forwarded-Proto-Version HTTP/2.0 if is-http2
    http-request set-header X-Forwarded-Proto-Version %[capture.req.ver] if !is-http2

    use_backend local_node_h2 if is-http2
    default_backend local_node_h1

backend local_node_h1
    mode http
    server localhost localhost:8079

backend local_node_h2
    mode http
    server localhost localhost:8080 proto h2
